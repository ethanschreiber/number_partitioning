from __future__ import print_function
from matplotlib.backends.backend_pdf import PdfPages
import sys
import ProcessExperimentsLibrary  # Import Library
lib = ProcessExperimentsLibrary   # Give short name
from optparse import OptionParser

import matplotlib.pyplot as plt
import numpy as np


COLOR = {"rnp"     : '.5',\
         "snp"     : '0.0',\
         "moffitt" : '1.0',\
         "bsbc_IE50"    : '1.0',\
         "bsbcp"   : '0.0',\
         "ciw"     : '1.0',\
         "ciwlc"   : '0.0'}



# These are for 25 to 52
RNP = [[],[],[], # 0 1 2
       [.015,.027,.049,.087,.158,.279,.500,.939,2,3,6,10,19,35,63,115,180,280,383,392,307,75,61,48,34,25,21,16 ], # 3
       [.017,.029,.050,.086,.148,.278,.474,.831,2,3,5,9,17,32,60,112,211,389,704,1340,2538,4810,9139,7011], #4
       [.117,.210,.418,1,1,3,5,11,22,43,104,208,505,871,2406,5469,9937,21009], #5
       [.227,.381,.616,1,2,4,6,12,20,38,68,143,235,474,823,1583,2869,5426], #6
       [05,6,10,5,8,23,54,105,252,607,1345,2046,8803], #7
       [02,3,7,6,10,10,14,12,23,34,78,102,218,365,719,1314,2648,5187,10752], #8
       [59,150,380,731,1527,3032,3301,2491,3632,12433,21021], #9
       [57, 87, 385, 590, 1388, 1971]] #10
    
  
def plotExperiments(filename, MARKERS, numBits, minN, maxN, minK, ALGORITHMS,ALG_NAMES): 
    maxK=minK+1
    outFile = open(filename,"w")
    
    NArray=[]
    for N in range (minN,maxN+1) :
        NArray.append(N)
    RNPNArray=[]
    for N in range (25,53) :
        RNPNArray.append(N)
    fig, axarr = plt.subplots(2,1, sharex=False)
    fig.set_canvas(plt.gcf().canvas)
    fig.set_size_inches(7.5,9)

    coordsX = 0

    legend = ["RNP"] # Hard code RNP
    for i in range(len(ALGORITHMS)) :   
        legend.append(ALG_NAMES[ALGORITHMS[i]])

    for k in range(minK,maxK+1) :
        ax = axarr[coordsX]
        ax.grid(True) 
        allTimes = []
        for i in range(len(ALGORITHMS)) :
            allTimes.append([])
            
        for N in range(minN, maxN+1) :
            for i in range(len(ALGORITHMS)) :
                algorithm = ALGORITHMS[i]
                inputFilename = lib.filename(k,N,algorithm,100,numBits)
                time = lib.processExperiment(inputFilename,100,1)
                allTimes[i].append(time)
        
        ax.set_title('k = ' + str(k))
                    
        
        # First print RNP results from static array
        ax.plot(RNPNArray,RNP[k],"ks--",markerfacecolor="1.0",markersize=7)

        for i in range(len(ALGORITHMS)) :
            algorithm = ALGORITHMS[i]
            marker = MARKERS[algorithm]            
            color = COLOR[algorithm]
            #plt.plot(NArray,allTimes[i],marker,markerfacecolor='w',markersize=5)
            #axarr[k-minK].plot(NArray,allTimes[i])
            ax.plot(NArray,allTimes[i],marker,markerfacecolor=color,markersize=7)
        
        if k == minK :
            ax.legend(legend, loc='lower right', fontsize=10,ncol=2)
        else :
            ax.set_xlabel("n")
        
        ax.set_ylabel("Time (s)")
        ax.set_yscale('log')

        #maxValue = max(map(max,allTimes))
        #minValue = 0 - (maxValue / 50.0)
        
        #plt.ylim(minValue,maxValue)

        coordsX = coordsX + 1

            #plt.suptitle('Average Run Time for 48-Bit Instances')
    print("Writing",filename)    
        #pdf.savefig(bbox_inches='tight')

    fig.savefig(filename, format='pdf',bbox_inches='tight')
    
    

# ======================
# Read from Command line
# ======================
parser = OptionParser()
parser.add_option("-f", "--file"  , dest="filename"      ,help="(Required) Prefix of filename to write to", metavar="str")

(options, args) = parser.parse_args()

if (options.filename == None) :    
    parser.print_help()
    print("\n *** Error: Missing required parameters ***\n")
    sys.exit(0)

# ===========
# Run Program
# ===========


MARKERS = {"rnp"      : "ks--",\
           "snp"      : "ks--",\
           "moffitt"  : "k+--",\
           "bsbc_IE50": "ko--",\
           "bsbcp"    : "ko--",\
           "ciw"      : "k^--",\
           "ciwlc"    : "k^--"}

ALG_NAMES = {"rnp"      : "IRNP",\
             "snp"      : "SNP",\
             "moffitt"  : "Moffitt",\
             "bsbc_IE50": "BSIBC",\
             "bsbcp"    : "BSBCP",\
             "ciw"      : "CIW",\
             "ciwlc"    : "LCS"}


ALGORITHMS      = ['rnp','snp','moffitt','bsbc_IE50','bsbcp','ciw','ciwlc']

minN=20
maxN=60
for i in range(len(RNP)) :
    while len(RNP[i]) < (52-25)+1 :
        RNP[i].append(float('nan'))

for k in range(3,11,2) :
    filename = options.filename + "_" + str(k) + "_" + str(k+1) + "_plot.pdf"
    print ("Out Filename : " + filename)
    plotExperiments(filename,MARKERS,48,minN,maxN,k,ALGORITHMS,ALG_NAMES)


