\documentclass{article}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{etoolbox}
\usepackage{multirow}
% For square brackets for bordermatrix
\let\bbordermatrix\bordermatrix
\patchcmd{\bbordermatrix}{8.75}{4.75}{}{}
\patchcmd{\bbordermatrix}{\left(}{\left[}{}{}
\patchcmd{\bbordermatrix}{\right)}{\right]}{}{}

\newcommand{\bm}[1]{\mbox{\boldmath $#1$}}  % puts the arument in bold

\newcommand{\columnvec}[1]{
  \left[
    \begin{array}{c}
      #1
    \end{array}
  \right]
}

\newenvironment{packed_enumerate}{ 
\begin{enumerate}
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}  
  \setlength{\parsep}{0pt} 
}{\end{enumerate}}

\newenvironment{packed_itemize}{
\begin{itemize}
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}  
  \setlength{\parsep}{0pt} 
}{\end{itemize}}


\begin{document}

\title{Cutting Stock Problem }
\author{Ethan Schreiber}

\maketitle+

\section{Problem}

\begin{tabular}{rl}
\textbf{Given:} & Sheets of size $W=20"$.\\
\textbf{Goal:}  &Fulfill the following orders using the fewest number
of sheets of size $W$ as possible:
\end{tabular}
\begin{center}
\begin{tabular}{c c}
\textbf{Size} & \textbf{Quantity (\bm{b_i}}) \\
\hline
9'' & 511 \\
8'' & 301\\
7'' & 263\\
6'' & 383\\
\end{tabular}
\end{center}


Let:
\begin{packed_itemize}
\item \bm{x_j} be the number of sheets cut using pattern $j$.
\item $\columnvec{a\\b\\c\\d}$ be a pattern with
      $\columnvec{a \text{ 9'' sheets}\\
                  b \text{ 8'' sheets}\\
                  c \text{ 7'' sheets}\\ 
                  d \text{ 6'' sheets.}}$
\end{packed_itemize}

\subsection{LP Formulation} \label{lp_formulation}
\begin{align*}
\textbf{Min: } &\sum x_j\\
\textbf{Such That: } & \sum a_{ij} x_j = b_i\\
& x_j \geq 0 \text{ and integer}
\end{align*}


\section{LP Optimum}

\begin{align*}
\columnvec{2\\0\\0\\0} &= 255.5 \hspace{8mm}
\columnvec{0\\2\\0\\0} = 87.625\hspace{8mm}
\columnvec{0\\0\\2\\1} = 131.5 \hspace{8mm}
\columnvec{0\\1\\0\\2} = 125.75\\\\ 
\textbf{Total} &= 600.375
\end{align*}

\section{Patterns}
Four patterns, each column represents a pattern:

\begin{align*}
\bm{B} &= \bbordermatrix{
  ~  & P_1 & P_2 & P_3 & P_4 \cr
  9" & 2 & 0 & 0 & 0 \cr
  8" & 0 & 2 & 0 & 0 \cr
  7" & 0 & 0 & 2 & 0 \cr
  6" & 0 & 0 & 0 & 3 \cr
}\\\\
\bm{P} &= \columnvec{P_1\\P_2\\P_3\\P_4} =
\columnvec{255.5\\150.5\\131.5\\127.66}\\
& \hspace{9mm} \text{Total} = 665.16
\end{align*}

This is optimal if we evaluate $C_j-Z_j$ of all non-basic variables
(patterns) and they are all positive. That is, all patterns that are
not listed in $\bm{B}$. A pattern with negative $C_j-Z_j$ can enter the basis.

\subsection{Finding a negative $C_j-Z_j$}

Dual of \ref{lp_formulation}
\begin{align*}
\textbf{Min} \sum 
\end{align*}

\begin{align*}
  \begin{array}{r l c r l}
    \multicolumn{2}{l}{\textbf{Primary LP Formulation}} & & \multicolumn{2}{l}{\textbf{Dual LP Formulation}}\\\\
    \textbf{Min: }           &\sum x_j                        & & \textbf{Max:}         & \sum b_i y_i\\
    \textbf{Such That: }     & \sum a_{ij} x_j = b_i           & &  \textbf{Such That: } & a_{ij}y_i \leq 1\\
                             & x_j \geq 0 \text{ and integer} & &                       & y_i \text{ unrestricted in sign}
  \end{array}
\end{align*}

Note that $a_{ij}$ of the dual is the transpose of $a_{ij}$ for the primary is the transpose of $a_{ij}$ for the dual.\\

\noindent Entering pattern should have:
\begin{align*}
C_j - Z_j  &\leq 0\\
C_j - yP_j & \leq 0 \hspace{5mm} \textbf{Since: } Z_j = yP_j \\
yP_j & > 1 \hspace{5mm} \textbf{Since: } \text{All $C_j$ are 1 because all maximization coefficients are 1}  \\
\end{align*}

If pattern is $P=\columnvec{a\\b\\c\\d}$, then $9a+8b+7c+6d \leq 20$. We now solve for $y$ using the formula $yB=C_B$:

\begin{align*}
\begin{array}{c c c c}
y & B & = & C_B  \\
~[y_1\;y_2\;y_3\;y_4] & 
\left[
  \begin{array}{c c c c}
    2 & 0 & 0 & 0\\
    0 & 2 & 0 & 0\\
    0 & 0 & 2 & 0\\
    0 & 0 & 0 & 3
  \end{array}
\right]
& = & ~[1\;1\; 1\; 1]
\end{array}
\end{align*}
\begin{align*}
\bbordermatrix{
   ~ & y_1 & y_2 & y_3 & y_4 \cr
   y= ~ & \frac{1}{2} & \frac{1}{2} & \frac{1}{2} & \frac{1}{3}
}
\end{align*}

Now that we have solved for $y$, we try to find the pattern $P_j$ such that y$P_j$ is maximized:
\begin{align*}
  \begin{array}{ll}
    \multirow{3}{*}{$P = \columnvec{a\\b\\c\\d}$} &9a + 8b + 7c + 6d \leq 20\\
    &\frac{1}{2} a +\frac{1}{2} b + \frac{1}{2} c + \frac{1}{3} d > 1  \hspace{5mm} (y P_j > 1)\\
    &a,b,c,d >= 0 \text{ \& Integer}
  \end{array}\\
\end{align*}

\noindent Reformulate as ILP Knapsack Problem:
\begin{align*}
\textbf{Max: } & \frac{1}{2} a +\frac{1}{2} b + \frac{1}{2} c + \frac{1}{3} d \\
\textbf{Such That: } & 9a+8b+7c+6d \leq 20 \\
& a,b,c,d \geq 0 \text{ and integer}
\end{align*}

We solve the knapsack (details omitted) and come up with this pattern which enter the basis:
\begin{align*}
P = \columnvec{0\\0\\2\\1}
\end{align*}
We now find the leaving pattern by solving $\bar{P}_j$ using the formula $B\bar{P}_j = P_j$.
\begin{align*}
\begin{array}{c c c c}
B & \bar{P}_j & = & P_j  \\
\left[
  \begin{array}{c c c c}
    2 & 0 & 0 & 0\\
    0 & 2 & 0 & 0\\
    0 & 0 & 2 & 0\\
    0 & 0 & 0 & 3
  \end{array}
\right] &
\columnvec{a\\b\\c\\d}
& = & \columnvec{0\\0\\2\\1}
\end{array}
\end{align*}
\begin{align*}
\bar{P}_j &= \columnvec{0\\0\\1\\\frac{1}{3}}
\end{align*}
\begin{align*}
P_1:\; & 255.5 - 0 \theta \geq 0\\
P_2:\; & 150.5 - 0 \theta \geq 0\\
P_3:\; & 131.5 - 1 \theta \geq 0 \hspace{5mm} \implies \hspace{5mm} 131.5 \geq \theta \checkmark \\
P_4:\; & 127.66 - \frac{1}{3} \theta \geq 0 \hspace{5mm} \implies \hspace{5mm} 382.98 \geq \theta\\\\
\theta = 131.5
\end{align*}

Therefore, the pattern $P_3=\columnvec{0\\0\\2\\0}$ is replaced with $\columnvec{0\\0\\2\\1}:$
\begin{align*}
\bm{B} &= \bbordermatrix{
  ~  & P_1 & P_2 & P_3 & P_4 \cr
  9" & 2 & 0 & \bm{0} & 0 \cr
  8" & 0 & 2 & \bm{0} & 0 \cr
  7" & 0 & 0 & \bm{2} & 0 \cr
  6" & 0 & 0 & \bm{0} & 3 \cr
}
\; \rightarrow \;
\bbordermatrix{
  ~  & P_1 & P_2 & P_3 & P_4 \cr
  9" & 2 & 0 & \bm{0} & 0 \cr
  8" & 0 & 2 & \bm{0} & 0 \cr
  7" & 0 & 0 & \bm{2} & 0 \cr
  6" & 0 & 0 & \bm{1} & 3 \cr
}
\end{align*}



\hrule
\;
\textbf{New LP Solution}: $P_1 - P_3$ stay the same but for $P_4: 127.66 - \frac{1}{3} \theta = 127.66 - \frac{131.5}{3} = 127.66 - 43.833 = 83.83$
\begin{align*}
\bm{P} &= \columnvec{P_1\\P_2\\P_3\\P_4} =
\columnvec{255.5\\150.5\\131.5\\\bm{83.83}}\\
& \hspace{9mm} \text{Total} = \bm{621.33}
\end{align*}


\begin{align*}
\begin{array}{c c c c}
y & B & = & C_B  \\
~[y_1\;y_2\;y_3\;y_4] & 
\left[
  \begin{array}{c c c c}
    2 & 0 & 0 & 0\\
    0 & 2 & 0 & 0\\
    0 & 0 & 2 & 0\\
    0 & 0 & 1 & 3
  \end{array}
\right]
& = & ~[1\;1\; 1\; 1]
\end{array}
\end{align*}
\begin{align*}
\bbordermatrix{
   ~ & y_1 & y_2 & y_3 & y_4 \cr
   y= ~ & \frac{1}{2} & \frac{1}{2} & \frac{1}{3} & \frac{1}{3}
}
\end{align*}



Now that we have solved for $y$, we try to find the pattern $P_j$ such that y$P_j$ is maximized:
\begin{align*}
  \begin{array}{ll}
    \multirow{3}{*}{$P = \columnvec{a\\b\\c\\d}$} &9a + 8b + 7c + 6d \leq 20\\
    &\frac{1}{2} a +\frac{1}{2} b + \frac{1}{3} c + \frac{1}{3} d > 1  \hspace{5mm} (y P_j > 1)\\
    &a,b,c,d >= 0 \text{ \& Integer}
  \end{array}\\
\end{align*}

\noindent Reformulate as ILP Knapsack Problem:
\begin{align*}
\textbf{Max: } & \frac{1}{2} a +\frac{1}{2} b + \frac{1}{3} c + \frac{1}{3} d \\
\textbf{Such That: } & 9a+8b+7c+6d \leq 20 \\
& a,b,c,d \geq 0 \text{ and integer}
\end{align*}

We solve the knapsack (details omitted) and come up with this pattern which enter the basis:
\begin{align*}
P = \columnvec{0\\1\\0\\2}
\end{align*}
We now find the leaving pattern by solving $\bar{P}_j$ using the formula $B\bar{P}_j = P_j$.
\begin{align*}
\begin{array}{c c c c}
B & \bar{P}_j & = & P_j  \\
\left[
  \begin{array}{c c c c}
    2 & 0 & 0 & 0\\
    0 & 2 & 0 & 0\\
    0 & 0 & 2 & 0\\
    0 & 0 & 1 & 3
  \end{array}
\right] &
\columnvec{a\\b\\c\\d}
& = & \columnvec{0\\0\\2\\1}
\end{array}
\end{align*}
\begin{align*}
\bar{P}_j &= \columnvec{0\\\frac{1}{2}\\0\\\frac{2}{3}}
\end{align*}
\begin{align*}
P_1:\; & 255.5 - 0 \theta \geq 0\\
P_2:\; & 150.5 - \frac{1}{2} \theta \geq 0 \implies \hspace{5mm} 301 \geq \theta\\
P_3:\; & 131.5 - 0 \theta \geq 0 \\
P_4:\; & 83.83 - \frac{2}{3} \theta \geq 0 \hspace{5mm} \implies \hspace{5mm} 125.75 \geq \theta \checkmark\\\\
\theta = 125.75
\end{align*}

Therefore, the pattern $P_4=\columnvec{0\\0\\0\\3}$ is replaced with $\columnvec{0\\1\\0\\2}:$
\begin{align*}
\bbordermatrix{
  ~  & P_1 & P_2 & P_3 & P_4 \cr
  9" & 2 & 0 & 0 & \bm{0} \cr
  8" & 0 & 2 & 0 & \bm{0} \cr
  7" & 0 & 0 & 2 & \bm{0} \cr
  6" & 0 & 0 & 1 & \bm{3} \cr
}
\; \rightarrow \;
\bbordermatrix{
  ~  & P_1 & P_2 & P_3 & P_4 \cr
  9" & 2 & 0 & 0 & \bm{0} \cr
  8" & 0 & 2 & 0 & \bm{1} \cr
  7" & 0 & 0 & 2 & \bm{0} \cr
  6" & 0 & 0 & 1 & \bm{2} \cr
}
\end{align*}


\hrule
\;
\textbf{New LP Solution}: \\
$P_2: 150.5 - \frac{1}{2} \theta = 150.5 - \frac{125.75}{2} = 87.625$\\
$P_4: \theta = 125.75$
\begin{align*}
\bm{P} &= \columnvec{P_1\\P_2\\P_3\\P_4} =
\columnvec{255.5\\\bm{87.625}\\131.5\\\bm{125.75}}\\
& \hspace{9mm} \text{Total} = \bm{600.375}
\end{align*}


\begin{align*}
\begin{array}{c c c c}
y & B & = & C_B  \\
~[y_1\;y_2\;y_3\;y_4] & 
\left[
  \begin{array}{c c c c}
    2 & 0 & 0 & 0\\
    0 & 2 & 0 & 1\\
    0 & 0 & 2 & 0\\
    0 & 0 & 1 & 2
  \end{array}
\right]
& = & ~[1\;1\; 1\; 1]
\end{array}
\end{align*}
\begin{align*}
\bbordermatrix{
   ~ & y_1 & y_2 & y_3 & y_4 \cr
   y= ~ & \frac{1}{2} & \frac{1}{2} & \frac{3}{8} & \frac{1}{4}
}
\end{align*}



Now that we have solved for $y$, we try to find the pattern $P_j$ such that y$P_j$ is maximized:
\begin{align*}
  \begin{array}{ll}
    \multirow{3}{*}{$P = \columnvec{a\\b\\c\\d}$} &9a + 8b + 7c + 6d \leq 20\\
    &\frac{1}{2} a +\frac{1}{2} b + \frac{3}{8} c + \frac{1}{4} d > 1  \hspace{5mm} (y P_j > 1)\\
    &a,b,c,d >= 0 \text{ \& Integer}
  \end{array}\\
\end{align*}

\noindent Reformulate as ILP Knapsack Problem:
\begin{align*}
\textbf{Max: } & \frac{1}{2} a +\frac{1}{2} b + \frac{3}{8} c + \frac{1}{4} d \\
\textbf{Such That: } & 9a+8b+7c+6d \leq 20 \\
& a,b,c,d \geq 0 \text{ and integer}
\end{align*}

We solve the knapsack (details omitted) and no pattern with Z>1 exists so we are done!




\end{document}
